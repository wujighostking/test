webpackJsonp([20],{"1rTQ":function(e,t){},NsM9:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("mvHQ"),o=n.n(a),i=n("BO1k"),l=n.n(i),s=n("IcnI"),r=n("kkPa"),c={name:"Measurement",data:function(){return{isShowModifyButton:!0,tableData:[],oldTableData:"",options:[{label:"样点编号",value:"样点编号",children:[]}],searchForm:{content:""}}},components:{LightJSPanel:function(){return n.e(6).then(n.bind(null,"xffh"))}},mounted:function(){var e=this;s.a.state.map.on("click",this.init),Object(r.c)().then(function(t){200===t.data.code&&(e.tableData.length=0,t.data.data.forEach(function(t){e.options[0].children.push({label:t.iid,value:t.iid}),e.tableData.push({date:t.gettime,no:t.iid,lon:t.lon,lat:t.lat,location:t.address,gentle:t.landclass,crop:t.plantclass,weather:t.weather,temperature:t.temperature,reUploadFile:"",isModifyStatus:!1})}))})},methods:{close:function(){this.clear(),this.$emit("close",this)},clear:function(){s.a.state.map.off("click",this.init)},edit:function(e,t){this.tableData[e].isModifyStatus=!0,this.$refs.multipleTable.toggleRowSelection(t,!0),this.isShowModifyButton=!1},search:function(){var e=this;this.searchForm.content?(console.log(this.searchForm.content[1]),Object(r.d)(this.searchForm.content[1]).then(function(t){if(200===t.data.code){var n=t.data.data;e.tableData.length=0,console.log(n,e.tableData),e.tableData.push({date:n.gettime,no:n.iid,lon:n.lon,lat:n.lat,location:n.address,gentle:n.landclass,crop:n.plantclass,weather:n.weather,temperature:n.temperature,reUploadFile:"",isModifyStatus:!1})}})):this.$message({showClose:!0,message:"请输入你要查询的样点",type:"warning"})},addData:function(){this.$emit("AddDateAndSheet")},del:function(){var e=this;this.$refs.multipleTable.selection.length?this.$confirm("此操作将永久删除所选文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t=e.$refs.multipleTable.selection;t.forEach(function(n){Object(r.b)(n.no).then(function(n){if(200===n.status&&200===n.data.code){e.$message({type:"success",message:"删除成功!"});var a=!0,o=!1,i=void 0;try{for(var s,r=l()(t);!(a=(s=r.next()).done);a=!0){var c=s.value;for(var u in e.tableData)if(e.tableData[u].no===c.no){e.tableData.splice(Number(u),1);break}}}catch(e){o=!0,i=e}finally{try{!a&&r.return&&r.return()}finally{if(o)throw i}}}}).catch(function(e){console.log(e)})})}).catch(function(){e.$message({type:"info",message:"已取消删除"})}):this.$message({showClose:!0,message:"请选择需要删除的样点",type:"warning"})},modify:function(){if(this.$refs.multipleTable.selection.length){this.oldTableData=o()(this.tableData);var e=this.$refs.multipleTable.selection,t=!0,n=!1,a=void 0;try{for(var i,s=l()(e);!(t=(i=s.next()).done);t=!0){var r=i.value;console.log(e),console.log(this.set(r,"isModifyStatus",!0))}}catch(e){n=!0,a=e}finally{try{!t&&s.return&&s.return()}finally{if(n)throw a}}for(var c in e);this.isShowModifyButton=!this.isShowModifyButton}else this.$message({showClose:!0,message:"请勾选修改的样点",type:"warning"})},determine:function(){var e=this;this.$confirm("请确定需要修改的行已被勾选？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"保存",cancelButtonText:"放弃"}).then(function(){var t=e.$refs.multipleTable.selection;console.log(t)}).catch(function(t){e.$message({type:"info",message:"cancel"===t?"放弃修改":"没有修改相关文件数据"})})},cancel:function(){this.tableData=JSON.parse(this.oldTableData),this.isShowModifyButton=!this.isShowModifyButton},viewSpectrum:function(){this.$emit("InformationList")},uploadSuccess:function(){this.$message.success("文件上传成功！")},uploadError:function(){this.$message.error("文件上传失败，请重试！")}}},u={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("LightJSPanel",{ref:"panelWidth",attrs:{options:{headerTitle:"数据管理",contentSize:{width:1125,height:600},resizeit:{handle:""},position:{my:"center",at:"center"}}},on:{close:e.close}},[n("div",{staticStyle:{margin:"10px"}},[n("div",{staticStyle:{display:"flex"}},[n("el-cascader",{staticClass:"search",attrs:{placeholder:"请输入需要查询的样点",options:e.options,filterable:""},model:{value:e.searchForm.content,callback:function(t){e.$set(e.searchForm,"content",t)},expression:"searchForm.content"}}),e._v(" "),n("div",{staticClass:"curd"},[n("el-button",{on:{click:e.search}},[e._v("查找")]),e._v(" "),n("el-button",{on:{click:e.addData}},[e._v("添加")]),e._v(" "),n("el-button",{on:{click:e.del}},[e._v("删除")]),e._v(" "),n("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isShowModifyButton,expression:"isShowModifyButton"}],on:{click:e.modify}},[e._v("修改")]),e._v(" "),n("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isShowModifyButton,expression:"!isShowModifyButton"}],on:{click:e.determine}},[e._v("确定")]),e._v(" "),n("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isShowModifyButton,expression:"!isShowModifyButton"}],on:{click:e.cancel}},[e._v("取消")])],1)],1),e._v(" "),n("div",[n("el-table",{ref:"multipleTable",attrs:{border:"","max-height":"500",height:500,data:e.tableData,"default-sort":{prop:"no",order:"ascending"}}},[e.tableData.length?n("el-table-column",{attrs:{type:"selection",align:"center"}}):e._e(),e._v(" "),e.tableData.length?n("el-table-column",{attrs:{type:"index",label:"序号",align:"center",width:"50"}}):e._e(),e._v(" "),n("el-table-column",{attrs:{prop:"date",label:"测量日期",align:"center",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{on:{dblclick:function(n){return e.edit(t.$index,t.row)}}},[e.tableData[t.$index].isModifyStatus?n("el-input",{model:{value:t.row.date,callback:function(n){e.$set(t.row,"date",n)},expression:"scope.row.date"}}):n("span",[e._v(e._s(t.row.date))])],1)]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"no",label:"样点编号",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{on:{dblclick:function(n){return e.edit(t.$index,t.row)}}},[e.tableData[t.$index].isModifyStatus?n("el-input",{attrs:{disabled:""},model:{value:t.row.no,callback:function(n){e.$set(t.row,"no",n)},expression:"scope.row.no"}}):n("span",[e._v(e._s(t.row.no))])],1)]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"lon",label:"经度",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{on:{dblclick:function(n){return e.edit(t.$index,t.row)}}},[e.tableData[t.$index].isModifyStatus?n("el-input",{model:{value:t.row.lon,callback:function(n){e.$set(t.row,"lon",n)},expression:"scope.row.lon"}}):n("span",[e._v(e._s(t.row.lon))])],1)]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"lat",label:"纬度",align:"center",width:"115"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{on:{dblclick:function(n){return e.edit(t.$index,t.row)}}},[e.tableData[t.$index].isModifyStatus?n("el-input",{model:{value:t.row.lat,callback:function(n){e.$set(t.row,"lat",n)},expression:"scope.row.lat"}}):n("span",[e._v(e._s(t.row.lat))])],1)]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"location",label:"地点",align:"center",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{on:{dblclick:function(n){return e.edit(t.$index,t.row)}}},[e.tableData[t.$index].isModifyStatus?n("el-input",{model:{value:t.row.location,callback:function(n){e.$set(t.row,"location",n)},expression:"scope.row.location"}}):n("span",[e._v(e._s(t.row.location))])],1)]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"gentle",label:"地类",align:"center",width:"85"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{on:{dblclick:function(n){return e.edit(t.$index,t.row)}}},[e.tableData[t.$index].isModifyStatus?n("el-input",{model:{value:t.row.gentle,callback:function(n){e.$set(t.row,"gentle",n)},expression:"scope.row.gentle"}}):n("span",[e._v(e._s(t.row.gentle))])],1)]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"crop",label:"作物",align:"center",width:"85"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{on:{dblclick:function(n){return e.edit(t.$index,t.row)}}},[e.tableData[t.$index].isModifyStatus?n("el-input",{model:{value:t.row.crop,callback:function(n){e.$set(t.row,"crop",n)},expression:"scope.row.crop"}}):n("span",[e._v(e._s(t.row.crop))])],1)]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"weather",label:"天气",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{on:{dblclick:function(n){return e.edit(t.$index,t.row)}}},[e.tableData[t.$index].isModifyStatus?n("el-input",{model:{value:t.row.weather,callback:function(n){e.$set(t.row,"weather",n)},expression:"scope.row.weather"}}):n("span",[e._v(e._s(t.row.weather))])],1)]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"temperature",label:"温度",align:"center",width:"85"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{on:{dblclick:function(n){return e.edit(t.$index)}}},[e.tableData[t.$index].isModifyStatus?n("el-input",{model:{value:t.row.temperature,callback:function(n){e.$set(t.row,"temperature",n)},expression:"scope.row.temperature"}}):n("span",[e._v(e._s(t.row.temperature))])],1)]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"spectral",label:"光谱/重新上传",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.tableData[t.$index].isModifyStatus?n("div",[n("el-upload",{attrs:{action:"#",accept:".xls,.xlsx","on-success":e.uploadSuccess,"on-error":e.uploadError}},[n("el-button",{attrs:{icon:"el-icon-document-add",size:"mini",title:"重新上传光谱文件"}})],1)],1):n("div",{staticClass:"view-spectrum",on:{click:e.viewSpectrum}},[e._v("查看\n            ")])]}}])})],1)],1)])])},staticRenderFns:[]};var d=n("VU/8")(c,u,!1,function(e){n("1rTQ")},"data-v-459bb3c0",null);t.default=d.exports},kkPa:function(e,t,n){"use strict";t.c=function(){return Object(a.a)({url:"/msg/allmsgs",method:"POST"})},t.d=function(e){var t=new URLSearchParams;return t.append("iid",e),Object(a.a)({url:"/msg/msg",method:"POST",data:t})},t.b=function(e){return Object(a.a)({url:"/msg/deletemsg",method:"POST",data:{iid:e}})},t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.gettime;return e.gettime=new Date(t).getTime(),Object(a.a)({url:"/msg/addmsg",method:"POST",data:e})};var a=n("0RrJ")},mvHQ:function(e,t,n){e.exports={default:n("qkKv"),__esModule:!0}},qkKv:function(e,t,n){var a=n("FeBl"),o=a.JSON||(a.JSON={stringify:JSON.stringify});e.exports=function(e){return o.stringify.apply(o,arguments)}}});